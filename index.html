<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="css/piccal-style.css">
    <title>PicCal - Make a calendar with the pictures you want</title>
</head>
<body onload="makeMonth()">
    <div>
      <span onclick="openNav()">open</span>
      <input type="radio" id="res_hd" name="radio_res" value="HD" checked>
      <label for="res_hd">HD(1280 x 720)</label>
      <input type="radio" id="res_fhd" name="radio_res" value="FHD">
      <label for="res_fhd">FHD(1920 x 1080)</label>
      <button type="button" id="fileSelect">사진 올리기</button>
      <button type="button" id="screenshot">이미지로 저장하기</button>
      <input type="file" id="fileElem" style="display: none;" accept=".jpg,.jpeg,.png,.bmp">
      <input type="color" id="bgColorPicker" value="#ffffff">
      <label for="bgColorPicker">배경색 지정</label>
      <input type="radio" name="radio_img_size" id="auto" checked>
      <label for="auto">가운데</label>
      <input type="radio" name="radio_img_size" id="width">
      <label for="width">폭에 맞추기</label>
      <input type="radio" name="radio_img_size" id="height">
      <label for="height">높이에 맞추기</label>
      <input type="radio" name="radio_img_size" id="full">
      <label for="full">틀에 맞추기</label>
    </div>
    <!-- Calendar Code Start -->
    <br>
    <div id="piccal-bg-img" style="position: relative;">
      <div class="container text-center" id="calendar_container" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
          <div class="row" name="title">
            <div class="col"></div>
            <div class="col-2" id="yearText"><h3 class="text-center" id="calTitle"></h3></div>
            <div class="col"></div>
        </div>
        <br>
        <div class="row" name="calendar">
          <div class="col" name="col-empty-left"></div>
          <div class="col" name="col-empty-left"></div>
          <div class="col">
            <table id="jan">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">1월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="feb">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">2월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="mar">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">3월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="apr">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">4월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col" name="col-empty-right"></div>
          <div class="col" name="col-empty-right"></div>
        </div>
        <br>
        <div class="row">
          <div class="col" name="col-empty-left"></div>
          <div class="col" name="col-empty-left"></div>
          <div class="col">
            <table id="may">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">5월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="jun">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">6월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="jul">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">7월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="aug">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">8월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col" name="col-empty-right"></div>
          <div class="col" name="col-empty-right"></div>
        </div>
        <br>
        <div class="row">
          <div class="col" name="col-empty-left"></div>
          <div class="col" name="col-empty-left"></div>
          <div class="col">
            <table id="sep">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">9월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="oct">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">10월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="nov">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">11월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col">
            <table id="dec">
              <tr>
                <td colspan="7" align="center"><div class="d-block bg-primary text-white rounded">12월</div></td>
              </tr>
              <tr>
                <td class="sunday">日</td>
                <td>月</td>
                <td>火</td>
                <td>水</td>
                <td>木</td>
                <td>金</td>
                <td class="saturday">土</td>
              </tr>
            </table>
          </div>
          <div class="col" name="col-empty-right"></div>
          <div class="col" name="col-empty-right"></div>
        </div>
      </div>
    </div>
    <!-- Calendar Code End -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="js/html2canvas.min.js"></script>
    <script type="text/javascript">
        // 달력 만들기
        const today = new Date();
        const month = new Array("jan", "feb", "mar", "apr",
                                "may", "jun", "jul", "aug",
                                "sep", "oct", "nov", "dec");

        document.getElementById("calTitle").innerHTML = `${today.getFullYear()}년`;

        function makeMonth() {
          resHD();

          for (let i = 0; i < month.length; i++) {
            loadCalendar(month[i], i, today);
          }
        }

        function loadCalendar(strMon, idxMon, objDate) {
            const firstDate = new Date(objDate.getFullYear(), idxMon, 1);
            const lastDate = new Date(objDate.getFullYear(), idxMon + 1, 0);
            const tbCalendar = document.getElementById(strMon);
            
            while (tbCalendar.rows.length > 2) {
              tbCalendar.deleteRow(tbCalendar.rows.length - 1);
            }

            let row = tbCalendar.insertRow();
            let index = 0;
            let cell;

            // 1일이 시작되기 전까지 공란을 생성
            for (let i = 0; i < firstDate.getDay(); i++) {
              cell = row.insertCell();
              index = index + 1;
            }

            // 1일 ~ 마지막 날까지 입력
            for (let valDate = 1; valDate <= lastDate.getDate(); valDate++) {
              cell = row.insertCell();
              cell.innerHTML = valDate;

              // 일요일
              if (index % 7 == 0) {
                  cell.innerHTML = `<font color=#ff0066>${valDate}`;
              }

              // 토요일
              if (index % 7 == 6) {
                  cell.innerHTML = `<font color=#0066ff>${valDate}`;
                  row = tbCalendar.insertRow();
              }

              // 오늘 날짜 강조 표시
              // * 조건 *
              // 시스템 연도 == 현재 작성 연도
              // && 시스템 월 == 현재 작성 월
              // && 시스템 일 == 현재 작성 일
              if (today.getFullYear() == objDate.getFullYear()
                  && today.getMonth() == idxMon
                  && today.getDate() == valDate) {
                      cell.bgColor = `#FAF58C`;
              }

              index = index + 1;
            }
        }

        // 이미지 다운로드 이벤트 리스너 정의
        const fileSelect = document.getElementById("fileSelect");
        const fileElem = document.getElementById("fileElem");
        const screenshot = document.getElementById("screenshot");

        fileSelect.addEventListener("click", function(e) {
            if (fileElem) {
                fileElem.click();
            }
        }, false);

        fileElem.addEventListener("change", function(e) {
            const file = fileElem.files[0];
            const reader = new FileReader();
            reader.onloadend = function() {
              document.getElementById("piccal-bg-img").style.backgroundImage = `url(${reader.result})`;
              document.getElementById("piccal-bg-img").style.backgroundRepeat = `no-repeat`;
              document.getElementById("piccal-bg-img").style.backgroundPosition = `center center`;
            }
            if (file) {
                reader.readAsDataURL(file);
            }
        }, false);

        // HTML2CANVAS
        // To render an element with html2canvas with some (optional) options, simply call html2canvas(element, options);
        screenshot.addEventListener("click", function(e) {
          html2canvas(document.getElementById("piccal-bg-img")).then(function(canvas) {
            const a = document.createElement("a");
            if (typeof a.download === "string") {
              a.href = canvas.toDataURL("image/png");
              a.download = "piccal-download-image.png";
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);
            } else {
              window.open(canvas.toDataURL("image/png"));
            }
          });
        }, false);

        // 라디오 버튼 이벤트 정의
        const radios = document.getElementsByName("radio_res");
        for (let i = 0; i < radios.length; i++) {
          radios[i].addEventListener("change", function (e) {
            setCalRes(e.returnValue, radios[i].id);
          }, false);
        }

        function setCalRes(val, rid) {
          if (val === true) {
            if (rid === "res_fhd") {
              resFHD();
            } else if (rid === "res_hd") {
              resHD();
            }
          }
        }

        const radios_pos = document.getElementsByName("radio_img_size");
        for (let i = 0; i < radios_pos.length; i++) {
          radios_pos[i].addEventListener("change", function(e) {
            setImgPosition(e.returnValue, radios_pos[i].id);
          }, false);
        }

        function setImgPosition(val, rid) {
          if (val === true) {
            switch (rid) {
              case "auto":
                document.getElementById("piccal-bg-img").style.backgroundSize = `auto`;
                break;
              case "width":
                document.getElementById("piccal-bg-img").style.backgroundSize = `100% auto`;
                break;
              case "height":
                document.getElementById("piccal-bg-img").style.backgroundSize = `auto 100%`;
                break;
              case "full":
                document.getElementById("piccal-bg-img").style.backgroundSize = `100% 100%`;
                break;
            }
          }
        }

        // 배경색 이벤트 정의
        const bgColor = document.getElementById("bgColorPicker");
        bgColor.addEventListener("change", function(e) {
          document.getElementById("piccal-bg-img").style.backgroundColor = e.target.value;
        }, false);

        function resFHD() {
          document.getElementById("piccal-bg-img").style.width = "1920px";
          document.getElementById("piccal-bg-img").style.height = "1080px";
        }

        function resHD() {
          document.getElementById("piccal-bg-img").style.width = "1280px";
          document.getElementById("piccal-bg-img").style.height = "720px";
        }
        
        var newYear;
        const numYear = document.getElementById("yearText");
        numYear.addEventListener("click", function(e) {
          const initYear = document.getElementById("calTitle");
          if (!initYear) return;
          
          const inputNum = document.createElement("input");          
          inputNum.type = "number"
          inputNum.value = newYear ? newYear : today.getFullYear();
          inputNum.style = "width: 80px; font-size: 25px; font-weight: bold;";
          inputNum.id = "setYear";
          inputNum.min = "1900";
          inputNum.max = "2150";
          inputNum.onkeydown = () => {
            return false;
          }
          
          numYear.appendChild(inputNum);
          inputNum.focus();
          numYear.removeChild(initYear);
        }, false);

        numYear.addEventListener("focusout", function(e) {
          const inputNum = document.getElementById("setYear");

          const editedYear = document.createElement("h3");
          editedYear.className = "text-center";
          editedYear.id = "calTitle";
          editedYear.innerHTML = inputNum.value + "년";

          newYear = inputNum.value;
          numYear.appendChild(editedYear);
          numYear.removeChild(inputNum);

          for (let i = 0; i < month.length; i++) {
            loadCalendar(month[i], i, new Date(newYear, 0, 1));
          }
        }, false);

        function eventFalse() {
          return false;
        }

        /* Open when someone clicks on the span element */
        function openNav() {
          document.getElementById("infoNav").style.width = "30%";
        }

        /* Close when someone clicks on the "x" symbol inside the overlay */
        function closeNav() {
          document.getElementById("infoNav").style.width = "0%";
        }
    </script>
  </body>

  <!-- The overlay -->
  <div id="infoNav" class="overlay">
    <!-- Button to close the overlay navigation -->
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>

    <!-- Overlay content -->
    <div class="overlay-content">
      <input type="image" name="infoBtn" src="img/question.png">
      <a href="#">About</a>
      <a href="#">Services</a>
      <a href="#">Clients</a>
      <a href="#">Contact</a>
    </div>
  </div>
</html>